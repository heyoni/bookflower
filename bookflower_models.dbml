// μ±…λ°”λΌκΈ° (Book Flower) - Django λ¨λΈ DBML
// νμ΄μ§€ κΈ°λ° λ…μ„ κΈ°λ΅ ν”λ«νΌ

Table users {
  id int [pk, increment]
  username varchar(150) [not null, unique, note: "μ‚¬μ©μ μ•„μ΄λ””"]
  email varchar(254) [not null, unique, note: "μ΄λ©”μΌ μ£Όμ†"]
  password varchar(128) [not null, note: "μ•”νΈν™”λ λΉ„λ°€λ²νΈ"]
  first_name varchar(150) [note: "μ΄λ¦„"]
  last_name varchar(150) [note: "μ„±"]
  is_staff boolean [default: false, note: "κ΄€λ¦¬μ μ—¬λ¶€"]
  is_active boolean [default: true, note: "ν™μ„± μƒνƒ"]
  date_joined datetime [not null, default: `now()`, note: "κ°€μ…μΌ"]
  last_login datetime [note: "λ§μ§€λ§‰ λ΅κ·ΈμΈ"]

  // μ¶”κ°€ ν•„λ“
  points int [default: 0, note: "λ…μ„ ν¬μΈνΈ"]
  badges json [default: '[]', note: "νλ“ν• λ°°μ§€ λ©λ΅ (JSON λ°°μ—΄)"]

  note: "μ‚¬μ©μ μ •λ³΄ (AbstractUser ν™•μ¥)"
}

Table books {
  id int [pk, increment]
  title varchar(200) [not null, note: "μ±… μ λ©"]
  author varchar(100) [note: "μ €μλ…"]

  note: "λ„μ„ μ •λ³΄"
}

Table reading_sessions {
  id int [pk, increment]
  user_id int [ref: > users.id, not null, note: "λ…μ„ν• μ‚¬μ©μ"]
  book_id int [ref: > books.id, not null, note: "μ½μ€ μ±…"]
  pages_read int [default: 0, note: "μ½μ€ νμ΄μ§€ μ"]
  earned_points int [default: 0, note: "νλ“ν• ν¬μΈνΈ"]
  completed boolean [default: false, note: "λ…μ„ μ™„λ£ μ—¬λ¶€"]
  created_at datetime [not null, default: `now()`, note: "κΈ°λ΅ μƒμ„±μΌ"]

  note: "λ…μ„ κΈ°λ΅ μ„Έμ… (νμ΄μ§€ κΈ°λ°)"
}

Table notes {
  id int [pk, increment]
  user_id int [ref: > users.id, not null, note: "λ…ΈνΈ μ‘μ„±μ"]
  book_id int [ref: > books.id, not null, note: "λ…ΈνΈ λ€μƒ μ±…"]
  page_until int [note: "μ½μ€ νμ΄μ§€ μ"]
  note text [note: "λ…ΈνΈ λ‚΄μ©"]
  created_at datetime [not null, default: `now()`, note: "λ…ΈνΈ μ‘μ„±μΌ"]

  note: "λ…μ„ λ…ΈνΈ"
}

Table reviews {
  id int [pk, increment]
  user_id int [ref: > users.id, not null, note: "λ¦¬λ·° μ‘μ„±μ"]
  book_id int [ref: > books.id, not null, note: "λ¦¬λ·° λ€μƒ μ±…"]
  content text [note: "λ…ν›„κ° λ‚΄μ©"]
  generated_by_ai boolean [default: true, note: "AI μƒμ„± μ—¬λ¶€"]
  created_at datetime [not null, default: `now()`, note: "λ…ν›„κ° μ‘μ„±μΌ"]

  note: "AI λ…ν›„κ°"
}

// μΈλ±μ¤ μ •μ
Table django_indexes {
  // Users
  idx_users_username [name: "users_username_idx", unique]
  idx_users_email [name: "users_email_idx", unique]

  // Reading Sessions
  idx_reading_sessions_user_created [name: "reading_sessions_user_created_idx"]
  idx_reading_sessions_completed [name: "reading_sessions_completed_idx"]

  // Notes
  idx_notes_user_book [name: "notes_user_book_idx"]
  idx_notes_created_at [name: "notes_created_at_idx"]

  // Reviews
  idx_reviews_user_book [name: "reviews_user_book_idx", unique]
  idx_reviews_created_at [name: "reviews_created_at_idx"]

  note: "λ°μ΄ν„°λ² μ΄μ¤ μΈλ±μ¤ (Django μλ™ μƒμ„± ν¬ν•¨)"
}

// κ΄€κ³„ λ° μ μ•½μ΅°κ±΄ μ„¤λ…
Note relationship_notes {
  '''
  μ£Όμ” κ΄€κ³„:
  1. users 1:N reading_sessions (ν• μ‚¬μ©μλ” μ—¬λ¬ λ…μ„ κΈ°λ΅ κ°€λ¥)
  2. users 1:N notes (ν• μ‚¬μ©μλ” μ—¬λ¬ λ…ΈνΈ μ‘μ„± κ°€λ¥)
  3. users 1:N reviews (ν• μ‚¬μ©μλ” μ—¬λ¬ λ…ν›„κ° μ‘μ„± κ°€λ¥)
  4. books 1:N reading_sessions (ν• μ±…μ€ μ—¬λ¬ λ…μ„ κΈ°λ΅ κ°€λ¥)
  5. books 1:N notes (ν• μ±…μ€ μ—¬λ¬ λ…ΈνΈ κ°€λ¥)
  6. books 1:N reviews (ν• μ±…μ€ μ—¬λ¬ λ…ν›„κ° κ°€λ¥)

  μ μ•½μ΅°κ±΄:
  - reviews.user_id + reviews.book_id (unique_together: μ‚¬μ©μλ‹Ή μ±…λ‹Ή ν•λ‚μ λ…ν›„κ°λ§)
  - λ¨λ“  μ™Έλν‚¤λ” CASCADE μ‚­μ 
  '''
}

Note business_logic {
  '''
  λΉ„μ¦λ‹μ¤ λ΅μ§:

  ν¬μΈνΈ μ‹μ¤ν…:
  - 1νμ΄μ§€ = 1ν¬μΈνΈ
  - reading_sessions.pages_read β†’ reading_sessions.earned_points
  - μ‚¬μ©μ μ΄ ν¬μΈνΈλ” users.pointsμ— λ„μ 

  ν•΄λ°”λΌκΈ° μ„±μ¥ λ‹¨κ³„:
  - μƒμ‹Ή λ‹¨κ³„: 0-99P (π±)
  - μ„±μ¥ λ‹¨κ³„: 100-499P (πΏ)
  - κ½ƒ λ‹¨κ³„: 500-999P (π»)
  - λ§κ° λ‹¨κ³„: 1000P+ (π»β¨)

  AI λ…ν›„κ° μƒμ„±:
  - notes ν…μ΄λΈ”μ λ…ΈνΈλ¥Ό κΈ°λ°μΌλ΅ AIκ°€ λ…ν›„κ° μƒμ„±
  - reviews.generated_by_ai = true
  - ν• μ‚¬μ©μλ‹Ή ν• μ±…λ‹Ή ν•λ‚μ λ…ν›„κ°λ§ ν—μ©
  '''
}

Note features {
  '''
  μ£Όμ” κΈ°λ¥:

  1. λ…μ„ κΈ°λ΅:
     - μμ λ΅μ΄ νμ΄μ§€ μ…λ ¥ λ°©μ‹ (μ‹κ°„ μΈ΅μ • μ—†μ)
     - λ…μ„ μ™„λ£μ‹ ν¬μΈνΈ μλ™ μ λ¦½

  2. λ…ΈνΈ μ‘μ„±:
     - μ±…λ³„ λ…μ„ λ…ΈνΈ κ΄€λ¦¬
     - νμ΄μ§€ λ²νΈμ™€ ν•¨κ» λ©”λ¨ κ°€λ¥

  3. AI λ…ν›„κ°:
     - μ‘μ„±ν• λ…ΈνΈλ¥Ό λ°”νƒ•μΌλ΅ λ…ν›„κ° μλ™ μƒμ„±
     - κ°μΈν™”λ λ…μ„ λ¶„μ„ μ κ³µ

  4. ν¬μΈνΈ μ‹μ¤ν…:
     - λ…μ„λ‰μ— λ”°λ¥Έ ν•΄λ°”λΌκΈ° μ„±μ¥
     - λ°°μ§€ μ‹μ¤ν… (JSONμΌλ΅ μ €μ¥)

  5. μ±… κ²€μƒ‰:
     - λ΅μ»¬ DB + μ™Έλ¶€ API ν†µν•© κ²€μƒ‰
     - λ‚΄ μ„μ¬μ— μ±… μ¶”κ°€ κΈ°λ¥
  '''
}