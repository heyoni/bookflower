{% extends 'base/base.html' %}

{% block title %}대시보드 - 책바라기{% endblock %}

{% block content %}
<div class="px-4 py-6 space-y-6">

    <!-- Welcome Section -->
    <div class="text-center">
        <h2 class="text-2xl font-bold text-gray-800 mb-2">
            {% if user.is_authenticated %}{{ user.username }}님, 안녕하세요! 🌻{% else %}안녕하세요! 🌻{% endif %}
        </h2>
        <p class="text-gray-600">오늘도 책과 함께 해바라기를 키워보세요</p>
    </div>

    {% if user.is_authenticated %}
    <!-- Sunflower Growth Card -->
    <div class="mobile-card sunflower-gradient p-6">
        <div class="text-center">
            <h3 class="text-lg font-bold text-yellow-900 mb-4 flex items-center justify-center">
                <span class="mr-2">🌻</span>내 해바라기
            </h3>

            <!-- Sunflower Stage -->
            <div class="mb-6">
                {% if user.points < 100 %}
                    <div class="text-6xl mb-2">🌱</div>
                    <p class="text-yellow-800 font-medium">새싹 단계</p>
                {% elif user.points < 500 %}
                    <div class="text-6xl mb-2">🌿</div>
                    <p class="text-yellow-800 font-medium">성장 단계</p>
                {% elif user.points < 1000 %}
                    <div class="text-6xl mb-2">🌻</div>
                    <p class="text-yellow-800 font-medium">꽃 단계</p>
                {% else %}
                    <div class="text-6xl mb-2">🌻✨</div>
                    <p class="text-yellow-800 font-medium">만개 단계</p>
                {% endif %}
            </div>

            <!-- Points Display -->
            <div class="bg-white/30 rounded-2xl p-4 mb-4">
                <div class="flex justify-between items-center mb-3">
                    <span class="text-yellow-900 font-medium">현재 포인트</span>
                    <span class="text-xl font-bold text-yellow-900">{{ user.points }}P</span>
                </div>
                <div class="w-full bg-white/50 rounded-full h-2">
                    {% if user.points < 100 %}
                        <div class="leaf-gradient h-2 rounded-full transition-all duration-500" style="width: {{ user.points }}%"></div>
                    {% elif user.points < 500 %}
                        <div class="leaf-gradient h-2 rounded-full transition-all duration-500" style="width: {% widthratio user.points 500 100 %}%"></div>
                    {% elif user.points < 1000 %}
                        <div class="leaf-gradient h-2 rounded-full transition-all duration-500" style="width: {% widthratio user.points 1000 100 %}%"></div>
                    {% else %}
                        <div class="leaf-gradient h-2 rounded-full transition-all duration-500" style="width: 100%"></div>
                    {% endif %}
                </div>
                <p class="text-sm text-yellow-800 mt-2 text-center">해바라기가 자라고 있어요!</p>
            </div>
        </div>
    </div>

    <!-- Stats Cards -->
    <div class="grid grid-cols-2 gap-4">
        <div class="mobile-card bg-white p-4">
            <div class="text-center">
                <div class="text-2xl mb-2">📚</div>
                <div class="text-2xl font-bold text-green-600">{{ reading_sessions_count }}</div>
                <div class="text-sm text-gray-600">독서 기록</div>
            </div>
        </div>

        <div class="mobile-card bg-white p-4">
            <div class="text-center">
                <div class="text-2xl mb-2">📝</div>
                <div class="text-2xl font-bold text-blue-600">{{ notes_count }}</div>
                <div class="text-sm text-gray-600">작성한 노트</div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="space-y-3">
        <h3 class="text-lg font-bold text-gray-800">빠른 실행</h3>

        <div class="grid grid-cols-2 gap-3">
            <a href="/books/search/" class="mobile-card bg-white p-4 text-center hover:bg-gray-50 transition-colors touch-target">
                <div class="text-3xl mb-2">🔍</div>
                <h4 class="font-bold text-gray-800 text-sm">책 검색</h4>
            </a>

            <a href="/reading/start/" class="mobile-card bg-white p-4 text-center hover:bg-gray-50 transition-colors touch-target">
                <div class="text-3xl mb-2">📖</div>
                <h4 class="font-bold text-gray-800 text-sm">독서 기록</h4>
            </a>
        </div>

        <div class="grid grid-cols-2 gap-3">
            <a href="/reading/notes/" class="mobile-card bg-white p-4 text-center hover:bg-gray-50 transition-colors touch-target">
                <div class="text-3xl mb-2">📝</div>
                <h4 class="font-bold text-gray-800 text-sm">내 노트</h4>
            </a>

            <a href="/reviews/" class="mobile-card bg-white p-4 text-center hover:bg-gray-50 transition-colors touch-target">
                <div class="text-3xl mb-2">🤖</div>
                <h4 class="font-bold text-gray-800 text-sm">AI 독후감</h4>
            </a>
        </div>
    </div>

    <!-- Recent Activity -->
    {% if recent_sessions %}
    <div class="mobile-card bg-white p-4">
        <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
            <span class="mr-2">📖</span>최근 활동
        </h3>
        <div class="space-y-3">
            {% for session in recent_sessions %}
            <div class="flex items-center p-3 bg-gray-50 rounded-xl">
                <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center mr-3 flex-shrink-0">
                    <span class="text-lg">📚</span>
                </div>
                <div class="flex-1 min-w-0">
                    <h4 class="font-medium text-gray-800 text-sm truncate">{{ session.book.title }}</h4>
                    <p class="text-xs text-gray-600">{{ session.created_at|date:"m/d" }} · {{ session.pages_read }}페이지</p>
                </div>
                <span class="text-green-600 font-bold text-sm flex-shrink-0">+{{ session.earned_points }}P</span>
            </div>
            {% endfor %}
        </div>

        {% if recent_sessions|length >= 5 %}
        <div class="text-center mt-4">
            <a href="/reading/notes/" class="text-blue-600 hover:text-blue-800 text-sm">더 보기 →</a>
        </div>
        {% endif %}
    </div>
    {% endif %}

    <!-- Goals Card -->
    <div class="mobile-card bg-gradient-to-br from-blue-50 to-purple-50 p-4">
        <h3 class="text-lg font-bold text-gray-800 mb-3 flex items-center">
            <span class="mr-2">🎯</span>이번 주 목표
        </h3>
        <div class="space-y-3 text-sm">
            <div class="flex items-center">
                <div class="w-4 h-4 rounded-full bg-green-400 mr-3 flex-shrink-0"></div>
                <span>독서 3회 완료 ✓</span>
            </div>
            <div class="flex items-center">
                <div class="w-4 h-4 rounded-full border-2 border-gray-300 mr-3 flex-shrink-0"></div>
                <span class="text-gray-600">노트 5개 작성</span>
            </div>
            <div class="flex items-center">
                <div class="w-4 h-4 rounded-full border-2 border-gray-300 mr-3 flex-shrink-0"></div>
                <span class="text-gray-600">AI 독후감 1개 생성</span>
            </div>
        </div>
    </div>

    {% else %}
    <!-- Not Authenticated - Mobile -->
    <div class="text-center py-12">
        <div class="text-6xl mb-4">🌻</div>
        <h2 class="text-2xl font-bold text-gray-800 mb-4">책바라기와 함께<br>독서 여행을 시작하세요!</h2>
        <p class="text-gray-600 mb-8 px-4">책을 읽고 해바라기를 키우며<br>지역 카페 쿠폰도 받아보세요</p>

        <div class="space-y-3 px-4">
            <a href="/accounts/signup/" class="block w-full mobile-button bg-yellow-500 text-white py-4 rounded-2xl text-lg font-medium hover:bg-yellow-600 transition-colors">
                회원가입하기
            </a>
            <a href="/accounts/login/" class="block w-full mobile-button bg-gray-200 text-gray-800 py-4 rounded-2xl text-lg font-medium hover:bg-gray-300 transition-colors">
                로그인
            </a>
        </div>

        <!-- Features Preview -->
        <div class="grid grid-cols-2 gap-4 mt-8 px-4">
            <div class="mobile-card bg-white p-4 text-center">
                <div class="text-2xl mb-2">📚</div>
                <p class="text-sm font-medium text-gray-800">독서 기록</p>
            </div>
            <div class="mobile-card bg-white p-4 text-center">
                <div class="text-2xl mb-2">🌱</div>
                <p class="text-sm font-medium text-gray-800">포인트 적립</p>
            </div>
            <div class="mobile-card bg-white p-4 text-center">
                <div class="text-2xl mb-2">☕</div>
                <p class="text-sm font-medium text-gray-800">카페 쿠폰</p>
            </div>
            <div class="mobile-card bg-white p-4 text-center">
                <div class="text-2xl mb-2">🤖</div>
                <p class="text-sm font-medium text-gray-800">AI 독후감</p>
            </div>
        </div>
    </div>
    {% endif %}

</div>

<!-- PWA-like styles for mobile -->
<style>
    @media (max-width: 640px) {
        .truncate {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
    }

    /* 터치 피드백 */
    .touch-target:active {
        transform: scale(0.98);
        transition: transform 0.1s;
    }

    /* 카드 호버 효과 */
    .mobile-card:hover {
        transform: translateY(-2px);
        transition: transform 0.2s ease-out;
    }
</style>
{% endblock %}