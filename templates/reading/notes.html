{% extends 'base/base.html' %}

{% block title %}λ‚΄ λ…ΈνΈ - μ±…λ°”λΌκΈ°{% endblock %}

{% block content %}
<div class="px-4 py-6 space-y-6">

    <!-- Header -->
    <div class="text-center">
        <div class="text-5xl mb-3">π“</div>
        <h1 class="text-2xl font-bold text-gray-800 mb-2">λ‚΄ λ…μ„ λ…ΈνΈ</h1>
        <p class="text-gray-600 text-sm">μ§€κΈκΉμ§€ μ‘μ„±ν• λ¨λ“  λ…μ„ λ…ΈνΈλ¥Ό ν™•μΈν•΄λ³΄μ„Έμ”</p>
    </div>

    {% if notes %}
        <div class="space-y-4">
            {% for note in notes %}
            <div class="mobile-card bg-white p-4">

                <!-- Book Info -->
                <div class="flex items-start justify-between mb-3">
                    <div class="flex items-start">
                        <div class="w-10 h-12 bg-blue-100 rounded-lg flex items-center justify-center mr-3 flex-shrink-0">
                            <span class="text-lg">π“</span>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3 class="text-sm font-bold text-gray-800 truncate">{{ note.book.title }}</h3>
                            <p class="text-xs text-gray-600">{{ note.book.author|default:"μ €μ λ―Έμƒ" }}</p>
                        </div>
                    </div>

                    <div class="text-right flex-shrink-0">
                        {% if note.page_until %}
                        <span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full">
                            {{ note.page_until }}p
                        </span>
                        {% endif %}
                        <p class="text-xs text-gray-500 mt-1">{{ note.created_at|date:"m/d" }}</p>
                    </div>
                </div>

                <!-- Note Content -->
                <div class="bg-gray-50 rounded-lg p-3 mb-3">
                    <div class="text-gray-800 text-sm leading-relaxed">
                        {{ note.note|linebreaks }}
                    </div>
                </div>

                <!-- Actions -->
                <div class="flex items-center justify-between pt-3 border-t border-gray-200">
                    <div class="flex items-center space-x-3 text-xs text-gray-500">
                        <span class="flex items-center">
                            <span class="mr-1">π“…</span>
                            {{ note.created_at|date:"mμ›” dμΌ" }}
                        </span>
                        <span class="flex items-center">
                            <span class="mr-1">π“</span>
                            {{ note.note|length }}μ
                        </span>
                    </div>

                    <div class="flex items-center space-x-2">
                        <button onclick="copyNote('{{ note.note|escapejs }}', '{{ note.book.title|escapejs }}')"
                                class="text-gray-400 hover:text-blue-500 transition-colors text-xs px-2 py-1 rounded hover:bg-blue-50 touch-target"
                                title="λ…ΈνΈ λ³µμ‚¬">
                            π“‹
                        </button>
                        <a href="{% url 'reviews:create' note.book.id %}"
                           class="text-gray-400 hover:text-purple-500 transition-colors text-xs px-2 py-1 rounded hover:bg-purple-50 touch-target"
                           title="AI λ…ν›„κ° μƒμ„±">
                            π¤–
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Summary Stats -->
        <div class="mt-12 bg-gradient-to-r from-blue-50 to-green-50 rounded-2xl p-8">
            <h3 class="text-xl font-bold text-gray-800 mb-6 text-center">π“ λ‚΄ λ…μ„ λ…ΈνΈ ν†µκ³„</h3>

            <div class="grid md:grid-cols-4 gap-6 text-center">
                <div class="bg-white/70 rounded-xl p-4">
                    <div class="text-2xl font-bold text-blue-600">{{ notes.count }}</div>
                    <p class="text-sm text-gray-600">μ΄ λ…ΈνΈ μ</p>
                </div>

                <div class="bg-white/70 rounded-xl p-4">
                    <div class="text-2xl font-bold text-green-600">
                        {% regroup notes by book as books_with_notes %}
                        {{ books_with_notes|length }}
                    </div>
                    <p class="text-sm text-gray-600">κΈ°λ΅ν• μ±…</p>
                </div>

                <div class="bg-white/70 rounded-xl p-4">
                    <div class="text-2xl font-bold text-purple-600">
                        {% for note in notes %}{% add note.note|length 0 %}{% empty %}0{% endfor %}
                    </div>
                    <p class="text-sm text-gray-600">ν‰κ·  κΈ€μ μ</p>
                </div>

                <div class="bg-white/70 rounded-xl p-4">
                    <div class="text-2xl font-bold text-orange-600">
                        {% if notes %}{{ notes.0.created_at|timesince }}{% else %}0μΌ{% endif %}
                    </div>
                    <p class="text-sm text-gray-600">λ§μ§€λ§‰ μ‘μ„±</p>
                </div>
            </div>
        </div>

    {% else %}
        <!-- Empty State -->
        <div class="mobile-card bg-white p-6 text-center">
            <div class="text-6xl mb-4">π“</div>
            <h2 class="text-xl font-bold text-gray-800 mb-3">μ•„μ§ μ‘μ„±ν• λ…ΈνΈκ°€ μ—†μ–΄μ”</h2>
            <p class="text-gray-600 mb-6 text-sm">λ…μ„λ¥Ό ν•λ©΄μ„ μΈμƒ κΉμ€ λ¶€λ¶„μ„ λ…ΈνΈλ΅ λ‚¨κ²¨λ³΄μ„Έμ”!</p>

            <div class="space-y-3">
                <a href="{% url 'reading:start' %}"
                   class="block w-full mobile-button bg-blue-500 text-white py-3 rounded-xl font-medium hover:bg-blue-600 transition-colors">
                    λ…μ„ κΈ°λ΅ν•κΈ°
                </a>
                <a href="{% url 'books:search' %}"
                   class="block w-full mobile-button sunflower-gradient text-white py-3 rounded-xl font-medium hover:opacity-90 transition-opacity">
                    μ±… μ°ΎκΈ°
                </a>
            </div>

            <!-- Tips -->
            <div class="mt-12 bg-gradient-to-r from-blue-50 to-purple-50 rounded-2xl p-8">
                <h3 class="text-lg font-bold text-gray-800 mb-4">π“ ν¨κ³Όμ μΈ λ…μ„ λ…ΈνΈ μ‘μ„±λ²•</h3>
                <div class="grid md:grid-cols-3 gap-4 text-sm">
                    <div class="text-center">
                        <div class="text-3xl mb-2">π’΅</div>
                        <h4 class="font-medium text-gray-800">ν•µμ‹¬ ν¬μΈνΈ</h4>
                        <p class="text-gray-600">μ±…μ ν•µμ‹¬ λ‚΄μ©μ΄λ‚ κΉ¨λ‹¬μμ„ κ°„λ‹¨ν λ©”λ¨ν•μ„Έμ”</p>
                    </div>
                    <div class="text-center">
                        <div class="text-3xl mb-2">β¤οΈ</div>
                        <h4 class="font-medium text-gray-800">μΈμƒ κΉμ€ λ¬Έκµ¬</h4>
                        <p class="text-gray-600">λ§μμ— λ“λ” κµ¬μ μ΄λ‚ λ¬Έμ¥μ„ κ·Έλ€λ΅ μ μ–΄λ‘μ„Έμ”</p>
                    </div>
                    <div class="text-center">
                        <div class="text-3xl mb-2">π¤”</div>
                        <h4 class="font-medium text-gray-800">κ°μΈμ  μƒκ°</h4>
                        <p class="text-gray-600">μ±…μ„ μ½μΌλ©° λ“  μƒκ°μ΄λ‚ λλ‚μ„ μμ λ΅­κ² μ μ–΄λ³΄μ„Έμ”</p>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}

    <!-- Back to Dashboard -->
    <div class="text-center">
        <a href="{% url 'dashboard' %}"
           class="mobile-button bg-gray-200 text-gray-800 px-6 py-3 rounded-xl font-medium hover:bg-gray-300 transition-colors">
            β† λ©”μΈμΌλ΅
        </a>
    </div>
</div>

<script>
function copyNote(noteContent, bookTitle) {
    const fullText = `γ€${bookTitle}γ€ λ…μ„ λ…ΈνΈ\n\n${noteContent}\n\n- μ±…λ°”λΌκΈ°μ—μ„ μ‘μ„±`;

    if (navigator.clipboard) {
        navigator.clipboard.writeText(fullText).then(function() {
            alert('λ…ΈνΈκ°€ ν΄λ¦½λ³΄λ“μ— λ³µμ‚¬λμ—μµλ‹λ‹¤!');
        });
    } else {
        // Fallback for older browsers
        const textArea = document.createElement('textarea');
        textArea.value = fullText;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        alert('λ…ΈνΈκ°€ ν΄λ¦½λ³΄λ“μ— λ³µμ‚¬λμ—μµλ‹λ‹¤!');
    }
}
</script>
{% endblock %}