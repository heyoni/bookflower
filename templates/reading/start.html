{% extends 'base/base.html' %}

{% block title %}ë…ì„œ ê¸°ë¡ - ì±…ë°”ë¼ê¸°{% endblock %}

{% block content %}
<div class="px-4 py-6 space-y-6">

    <!-- Header -->
    <div class="text-center">
        <div class="text-5xl mb-3">ğŸ“–</div>
        <h1 class="text-2xl font-bold text-gray-800 mb-2">ë…ì„œ ê¸°ë¡í•˜ê¸°</h1>
        <p class="text-gray-600 text-sm">ì–´ë–¤ ì±…ì„ ì½ìœ¼ì…¨ë‚˜ìš”?</p>
    </div>

    {% if messages %}
        {% for message in messages %}
            <div class="bg-{% if message.tags == 'error' %}red{% else %}green{% endif %}-50 border border-{% if message.tags == 'error' %}red{% else %}green{% endif %}-200 text-{% if message.tags == 'error' %}red{% else %}green{% endif %}-600 px-4 py-3 rounded-xl text-sm">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}

    <div class="mobile-card bg-white p-4">
        <form method="POST" class="space-y-5">
            {% csrf_token %}

            <!-- Book Selection Tabs -->
            <div class="border-b border-gray-200">
                <nav class="-mb-px flex">
                    <button type="button" onclick="showTab('recent')" id="recent-tab"
                            class="tab-button flex-1 border-b-2 border-yellow-500 text-yellow-600 py-3 text-sm font-medium text-center">
                        ìµœê·¼ ì½ì€ ì±…
                    </button>
                    <button type="button" onclick="showTab('new')" id="new-tab"
                            class="tab-button flex-1 border-b-2 border-transparent text-gray-500 py-3 text-sm font-medium text-center">
                        ìƒˆ ì±… ì¶”ê°€
                    </button>
                </nav>
            </div>

            <!-- Recent Books Tab -->
            <div id="recent-content" class="tab-content">
                <h3 class="text-base font-medium text-gray-800 mb-3">ìµœê·¼ ì½ì€ ì±…ì—ì„œ ì„ íƒ</h3>
                {% if recent_books %}
                    <div class="space-y-3">
                        {% for book in recent_books %}
                        <label class="flex items-center p-3 border-2 border-gray-200 rounded-xl hover:border-yellow-300 cursor-pointer transition-colors touch-target">
                            <input type="radio" name="book_id" value="{{ book.id }}" class="mr-3 text-yellow-600 h-4 w-4">
                            <div class="w-10 h-12 bg-yellow-100 rounded-lg mr-3 flex items-center justify-center flex-shrink-0">
                                <span class="text-lg">ğŸ“š</span>
                            </div>
                            <div class="flex-1 min-w-0">
                                <h4 class="font-medium text-gray-800 text-sm truncate">{{ book.title }}</h4>
                                <p class="text-xs text-gray-600">{{ book.author|default:"ì €ì ë¯¸ìƒ" }}</p>
                            </div>
                        </label>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-6 text-gray-500">
                        <div class="text-3xl mb-3">ğŸ“š</div>
                        <p class="text-sm">ì•„ì§ ì½ì€ ì±…ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                        <p class="text-xs">ìƒˆ ì±…ì„ ì¶”ê°€í•´ì„œ ë…ì„œë¥¼ ì‹œì‘í•´ë³´ì„¸ìš”!</p>
                    </div>
                {% endif %}
            </div>

            <!-- New Book Tab -->
            <div id="new-content" class="tab-content hidden">
                <h3 class="text-base font-medium text-gray-800 mb-3">ìƒˆ ì±… ì •ë³´ ì…ë ¥</h3>
                <div class="space-y-4">
                    <div>
                        <label for="book_title" class="block text-sm font-medium text-gray-700 mb-2">
                            ì±… ì œëª© *
                        </label>
                        <input type="text" name="book_title" id="book_title"
                               class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-base"
                               placeholder="ì½ì„ ì±…ì˜ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    <div>
                        <label for="book_author" class="block text-sm font-medium text-gray-700 mb-2">
                            ì €ì
                        </label>
                        <input type="text" name="book_author" id="book_author"
                               class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-base"
                               placeholder="ì €ìëª…ì„ ì…ë ¥í•˜ì„¸ìš” (ì„ íƒì‚¬í•­)">
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="pt-4 border-t border-gray-200 space-y-3">
                <button type="submit"
                        class="w-full mobile-button sunflower-gradient text-white py-4 rounded-xl font-medium hover:opacity-90 transition-opacity flex items-center justify-center">
                    <span class="mr-2">ğŸ“</span>
                    ë…ì„œ ê¸°ë¡í•˜ê¸°
                </button>
                <a href="{% url 'dashboard' %}"
                   class="block w-full mobile-button bg-gray-200 text-gray-800 py-3 rounded-xl font-medium hover:bg-gray-300 transition-colors text-center">
                    ì·¨ì†Œ
                </a>
            </div>
        </form>
    </div>

    <!-- Tips -->
    <div class="mobile-card bg-gradient-to-r from-yellow-50 to-green-50 p-4">
        <h3 class="text-base font-bold text-gray-800 mb-3 flex items-center">
            <span class="mr-2">ğŸ’¡</span>
            ë…ì„œ íŒ
        </h3>
        <div class="space-y-3">
            <div class="flex items-center">
                <div class="w-10 h-10 bg-white/50 rounded-lg flex items-center justify-center mr-3 flex-shrink-0">
                    <span class="text-lg">â°</span>
                </div>
                <div>
                    <h4 class="font-medium text-gray-800 text-sm">ê¾¸ì¤€íˆ ì½ê¸°</h4>
                    <p class="text-xs text-gray-600">ë§¤ì¼ ì¡°ê¸ˆì”©ì´ë¼ë„ ì½ì–´ë³´ì„¸ìš”</p>
                </div>
            </div>
            <div class="flex items-center">
                <div class="w-10 h-10 bg-white/50 rounded-lg flex items-center justify-center mr-3 flex-shrink-0">
                    <span class="text-lg">ğŸ“</span>
                </div>
                <div>
                    <h4 class="font-medium text-gray-800 text-sm">ë…¸íŠ¸ ì‘ì„±</h4>
                    <p class="text-xs text-gray-600">ì¸ìƒ ê¹Šì€ ë¶€ë¶„ì„ ê¸°ë¡í•´ë³´ì„¸ìš”</p>
                </div>
            </div>
            <div class="flex items-center">
                <div class="w-10 h-10 bg-white/50 rounded-lg flex items-center justify-center mr-3 flex-shrink-0">
                    <span class="text-lg">ğŸŒ±</span>
                </div>
                <div>
                    <h4 class="font-medium text-gray-800 text-sm">í¬ì¸íŠ¸ ì ë¦½</h4>
                    <p class="text-xs text-gray-600">ì½ì€ í˜ì´ì§€ë§Œí¼ í¬ì¸íŠ¸ë¥¼ ë°›ì•„ìš”</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function showTab(tab) {
    // Hide all tab contents
    const contents = document.querySelectorAll('.tab-content');
    contents.forEach(content => content.classList.add('hidden'));

    // Remove active class from all tabs
    const tabs = document.querySelectorAll('.tab-button');
    tabs.forEach(t => {
        t.classList.remove('border-yellow-500', 'text-yellow-600');
        t.classList.add('border-transparent', 'text-gray-500');
    });

    // Show selected tab content
    document.getElementById(tab + '-content').classList.remove('hidden');

    // Add active class to selected tab
    const activeTab = document.getElementById(tab + '-tab');
    activeTab.classList.remove('border-transparent', 'text-gray-500');
    activeTab.classList.add('border-yellow-500', 'text-yellow-600');

    // Clear form fields when switching tabs
    if (tab === 'recent') {
        document.getElementById('book_title').value = '';
        document.getElementById('book_author').value = '';
    } else {
        const radioButtons = document.querySelectorAll('input[name="book_id"]');
        radioButtons.forEach(radio => radio.checked = false);
    }
}
</script>

<!-- Mobile-optimized styles -->
<style>
    /* Touch feedback */
    button:active, .mobile-button:active, .touch-target:active {
        transform: scale(0.98);
        transition: transform 0.1s;
    }

    /* Radio button styling for mobile */
    input[type="radio"] {
        width: 18px;
        height: 18px;
    }

    /* Tab button styling */
    .tab-button {
        touch-action: manipulation;
        -webkit-tap-highlight-color: transparent;
    }

    /* Prevent iOS zoom on input focus */
    input[type="text"] {
        font-size: 16px;
    }

    /* Better touch targets for labels */
    label.touch-target {
        min-height: 56px;
    }
</style>
{% endblock %}