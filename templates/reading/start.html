{% extends 'base/base.html' %}

{% block title %}독서 기록 - 책바라기{% endblock %}

{% block content %}
<div class="px-4 py-6 space-y-6">

    <!-- Header -->
    <div class="text-center">
        <div class="text-5xl mb-3">📖</div>
        <h1 class="text-2xl font-bold text-gray-800 mb-2">독서 기록하기</h1>
        <p class="text-gray-600 text-sm">어떤 책을 읽으셨나요?</p>
    </div>

    {% if messages %}
        {% for message in messages %}
            <div class="bg-{% if message.tags == 'error' %}red{% else %}green{% endif %}-50 border border-{% if message.tags == 'error' %}red{% else %}green{% endif %}-200 text-{% if message.tags == 'error' %}red{% else %}green{% endif %}-600 px-4 py-3 rounded-xl text-sm">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}

    <div class="mobile-card bg-white p-4">
        <form method="POST" class="space-y-5">
            {% csrf_token %}

            <!-- Book Selection Tabs -->
            <div class="border-b border-gray-200">
                <nav class="-mb-px flex">
                    <button type="button" onclick="showTab('recent')" id="recent-tab"
                            class="tab-button flex-1 border-b-2 border-yellow-500 text-yellow-600 py-3 text-sm font-medium text-center">
                        최근 읽은 책
                    </button>
                    <button type="button" onclick="showTab('new')" id="new-tab"
                            class="tab-button flex-1 border-b-2 border-transparent text-gray-500 py-3 text-sm font-medium text-center">
                        새 책 추가
                    </button>
                </nav>
            </div>

            <!-- Recent Books Tab -->
            <div id="recent-content" class="tab-content">
                <h3 class="text-base font-medium text-gray-800 mb-3">최근 읽은 책에서 선택</h3>
                {% if recent_books %}
                    <div class="space-y-3">
                        {% for book in recent_books %}
                        <label class="flex items-center p-3 border-2 border-gray-200 rounded-xl hover:border-yellow-300 cursor-pointer transition-colors touch-target">
                            <input type="radio" name="book_id" value="{{ book.id }}" class="mr-3 text-yellow-600 h-4 w-4">
                            <div class="w-10 h-12 bg-yellow-100 rounded-lg mr-3 flex items-center justify-center flex-shrink-0">
                                <span class="text-lg">📚</span>
                            </div>
                            <div class="flex-1 min-w-0">
                                <h4 class="font-medium text-gray-800 text-sm truncate">{{ book.title }}</h4>
                                <p class="text-xs text-gray-600">{{ book.author|default:"저자 미상" }}</p>
                            </div>
                        </label>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-6 text-gray-500">
                        <div class="text-3xl mb-3">📚</div>
                        <p class="text-sm">아직 읽은 책이 없습니다.</p>
                        <p class="text-xs">새 책을 추가해서 독서를 시작해보세요!</p>
                    </div>
                {% endif %}
            </div>

            <!-- New Book Tab -->
            <div id="new-content" class="tab-content hidden">
                <h3 class="text-base font-medium text-gray-800 mb-3">새 책 정보 입력</h3>
                <div class="space-y-4">
                    <div>
                        <label for="book_title" class="block text-sm font-medium text-gray-700 mb-2">
                            책 제목 *
                        </label>
                        <input type="text" name="book_title" id="book_title"
                               class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-base"
                               placeholder="읽을 책의 제목을 입력하세요">
                    </div>
                    <div>
                        <label for="book_author" class="block text-sm font-medium text-gray-700 mb-2">
                            저자
                        </label>
                        <input type="text" name="book_author" id="book_author"
                               class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-base"
                               placeholder="저자명을 입력하세요 (선택사항)">
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="pt-4 border-t border-gray-200 space-y-3">
                <button type="submit"
                        class="w-full mobile-button sunflower-gradient text-white py-4 rounded-xl font-medium hover:opacity-90 transition-opacity flex items-center justify-center">
                    <span class="mr-2">📝</span>
                    독서 기록하기
                </button>
                <a href="{% url 'dashboard' %}"
                   class="block w-full mobile-button bg-gray-200 text-gray-800 py-3 rounded-xl font-medium hover:bg-gray-300 transition-colors text-center">
                    취소
                </a>
            </div>
        </form>
    </div>

    <!-- Tips -->
    <div class="mobile-card bg-gradient-to-r from-yellow-50 to-green-50 p-4">
        <h3 class="text-base font-bold text-gray-800 mb-3 flex items-center">
            <span class="mr-2">💡</span>
            독서 팁
        </h3>
        <div class="space-y-3">
            <div class="flex items-center">
                <div class="w-10 h-10 bg-white/50 rounded-lg flex items-center justify-center mr-3 flex-shrink-0">
                    <span class="text-lg">⏰</span>
                </div>
                <div>
                    <h4 class="font-medium text-gray-800 text-sm">꾸준히 읽기</h4>
                    <p class="text-xs text-gray-600">매일 조금씩이라도 읽어보세요</p>
                </div>
            </div>
            <div class="flex items-center">
                <div class="w-10 h-10 bg-white/50 rounded-lg flex items-center justify-center mr-3 flex-shrink-0">
                    <span class="text-lg">📝</span>
                </div>
                <div>
                    <h4 class="font-medium text-gray-800 text-sm">노트 작성</h4>
                    <p class="text-xs text-gray-600">인상 깊은 부분을 기록해보세요</p>
                </div>
            </div>
            <div class="flex items-center">
                <div class="w-10 h-10 bg-white/50 rounded-lg flex items-center justify-center mr-3 flex-shrink-0">
                    <span class="text-lg">🌱</span>
                </div>
                <div>
                    <h4 class="font-medium text-gray-800 text-sm">포인트 적립</h4>
                    <p class="text-xs text-gray-600">읽은 페이지만큼 포인트를 받아요</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function showTab(tab) {
    // Hide all tab contents
    const contents = document.querySelectorAll('.tab-content');
    contents.forEach(content => content.classList.add('hidden'));

    // Remove active class from all tabs
    const tabs = document.querySelectorAll('.tab-button');
    tabs.forEach(t => {
        t.classList.remove('border-yellow-500', 'text-yellow-600');
        t.classList.add('border-transparent', 'text-gray-500');
    });

    // Show selected tab content
    document.getElementById(tab + '-content').classList.remove('hidden');

    // Add active class to selected tab
    const activeTab = document.getElementById(tab + '-tab');
    activeTab.classList.remove('border-transparent', 'text-gray-500');
    activeTab.classList.add('border-yellow-500', 'text-yellow-600');

    // Clear form fields when switching tabs
    if (tab === 'recent') {
        document.getElementById('book_title').value = '';
        document.getElementById('book_author').value = '';
    } else {
        const radioButtons = document.querySelectorAll('input[name="book_id"]');
        radioButtons.forEach(radio => radio.checked = false);
    }
}
</script>

<!-- Mobile-optimized styles -->
<style>
    /* Touch feedback */
    button:active, .mobile-button:active, .touch-target:active {
        transform: scale(0.98);
        transition: transform 0.1s;
    }

    /* Radio button styling for mobile */
    input[type="radio"] {
        width: 18px;
        height: 18px;
    }

    /* Tab button styling */
    .tab-button {
        touch-action: manipulation;
        -webkit-tap-highlight-color: transparent;
    }

    /* Prevent iOS zoom on input focus */
    input[type="text"] {
        font-size: 16px;
    }

    /* Better touch targets for labels */
    label.touch-target {
        min-height: 56px;
    }
</style>
{% endblock %}